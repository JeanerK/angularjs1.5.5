### 1. angularJs入门

[TOC]



#### 1.1 angularjs是什么

angularjs是google开发的一套js前端框架，它通过新的属性和表达式扩展了html，通常用于构建单页面应用。

在angularjs的世界里，你最常在页面看到的，可能就是以 **ng-** 开头的各种属性，例如：

```html
<input ng-model = 'user.name'>

<span ng-bind = 'boss.age'></span>

...
```

本节只对这些属性（在angularjs的风格里，叫做指令，以下也以指令取代属性的叫法）提名。下面我们陈列几个常用的angularjs内置指令，给大家留个印象。

`ng-model` `ng-bind` `ng-repeat` `ng-click` `ng-options` ...

#### 1.2 angularjs应用的组成

####1.2.1. 一个index.html页面。

​	当我们在页面引入angular.js文件以后，浏览器会创建一个叫做“angular”的全局唯一对象，我们通过这个对象来调用angular.js提供的API，同时，将我们编写好的功能注册到这个对象之中。

```html
<html ng-app="MemoList">
  <head>
  	<script src="bower_components/angular/angular.js"></script>//请输入实际angular.js地址
  	<script src="bower_components/angular-ui-router/release/angular-ui-router.js"></script>
  </head>
  <body>
  	<div ui-view = "body"></div>
  </body>
</html>
```

​	一个angularjs单页应用只会存在一个完整的html文件，也就是index.html文件。

​	而页面之间的转换则是通过动态将html片断插入index.html文件中的指定位置，（我们先在页面定义一个div，并且通过 `ui-view` 定义一个位置。`ui-view` 是 `ui.rouer` 模块定义页面插入位置的指令），从而实现显示不同的内容，但页面不跳转（url变化是以锚点的形式变化，举例：浏览页面时回到顶部操作。。。）。

####1.2.2.一个index.module.js文件。

​	angular.module()函数有两种用法：

​	1.定义一个模块：此时，angular.module()接收两个参数：

​	**A. 模块名称 ；**
	**B，模块对其它模块的依赖（模块名称字符串数组）。**

​	2.引用一个模块：此时，angular.module()接收一个参数

​	**A.模块名称。**

```javasc
(function(){
  'use strict';
  angular.module('MemoList',['ui.router']);
})();
```

​	以上代码在angular这个全局唯一对象中注册了一个叫做 **MemoList** 的模块，并且申明了这个模块依赖 **ui.router** 模块。

####1.2.3.无数个xxx.controller.js文件

​	每个***.controller.js代表着一个控制器，并对应一个功能模块，在这个controller中，包含了这个功能模块的数据和行为，换句话说，页面的行为和数据由这个controller决定。

```javascript
(function(){
  //1.引用模块
  var app = angular.module('MemoList');
  //4.将当前控制器注册到些模块
  app.controller('UserController', userController);
  //3.将当前控制器的依赖注入到当前模块
  userController.$inject = ['$scope'];
  //2.定义页面对应的控制器
  function userController($scope) {
    $scope.user = {
      name: jack,
      age: 22
    }
  }
})();
```

​	在以上代码中，我们首先  `引用` 了 **MemoList** 这个模块，并将其赋给app这个局部变量；

​	然后定义了一个函数，这个函数里面只是在$scope中添加了一个叫做user的对象；

​	紧接着，我们将这个函数注册到我们所引用的模块中，并且命名为   `UserController` 

​	最后我们看第三行代码：`userController.$inject = ['$scope'];` 这里演示了angularjs的另一个核心功能：***依赖注入*** ；代码的含义就是userController这个函数执行时，将 `$scope` 这个对象作为参数传入userControler 这个函数，与模块定义相似，$inject 是一个数组，里面是当前控制器的依赖数组，是一个服务名称字符串数组。

​	需要注意的是，`$inject` 数组中的依赖顺序必须和函数申明中的形参位置 一 一 对应，否则依赖注入就会对象注入混乱，也就是将张三的帽子戴在了李四的头上，控制器中使用时就会报错，毕竟李四干不了张三能干的事儿。

​	`$scope` 对象是控制器和html页面之间的纽带, `$scope` 对象中的属性或方法可以并且只可以在与当前控制器对应的 `html`中使用，无需也不能带上 `$scope` 前缀。

​	 `$inject `数组类似于spring IOC中的 @Autowired。

####1.2.4.无数个html片断文件

每一个html片断都有一个与其对应controller，也就是一个***.controller.js文件。

```html
<div>
  <label for="name: "></label>
  <input ng-model="user.name">
</div>
```

​	以上   `html`片断存在一个angularjs内置指令，**ng-model**，这个指令是angularjs的灵魂指令，我们常说的双向数据绑定一般都是通过这个指令来实现，可以看到，在此`html`片断中，我们使用了`ng-model`指令，当前`html`片断与1.2.3中的`controler`相对应，在1.2.3中，我们可以看到，UserController中注入了一个叫做 `$scope` 的服务，并且在这个服务上添加了一个 `user` 对象，这个对象有两个属性，`age` `name` ；

​	当我们运行以上代码，页面什么也不会显示，因为我们没有指定html片断和controller绑定。




####1.2.5.将html片断文件和与其相对应的controller.js文件绑定起来的xxx.state.js文件

```javascript
(function(){
  //1.引用模块
  var app = angular.module('MemoList');
  
  //3.将当前控制器注册到些模块
  app.config(UserConfig);
  
  //4.这句可写可不写
  UserConfig.$inject = ['$stateProvider'];

  //2.定义页面对应的控制器
  function UserConfig($stateProvider) {
    //定义一个全局唯一的状态，名称(全局唯一，这样页面之间状态改变时才能精确定位到要显示的页面)叫做 "user"
    $stateProvider.state('user', {
      url: '/user',
      views: {
        'body': {
          templateUrl: 'user.html',
          controller: 'UserController',
          controllerAs: 'vm'
        }
      }
    })
  }
})();
```

​	引用模块是angularjs应用定义服务，定义控制器，定义路由的第一行代码，不再赘述。

​	在以后代码中，我们定义了一个函数  `UserConfig` ，这个函数依赖一个服务 `$stateProvider` ,`$stateProvider` 是 `ui.router` 模块中定义的一个服务，这个服务是为了取代 `angularjs` 自带的 `ngRoute` 而存在的，现在 ***angularjs + ui.router*** 被公认为构建 `angularjs` 单页面应用的最佳实践。

​	下面介绍   `$stateProvider` 的使用。

​	在   `ui.router` 对路由的处理中，将页面之间的内容变化叫做状态的变化，也就是当前的应用从一个状态转换到另一个状态。每个状态都有一个全局唯一的名称，正如上文中而每一个状态一般由以下几个部分组成：

​	A. url: 这个状态对应的url，当浏览器处于这个url时，这个状态被激活。
	B. views: 当前状态对应的视图

views 又由两部分组成，

​	1.插入点。

​	2.页面控制器绑定关系

​	插入点即这个视图会被  `ui.router` 插入到页面的什么地方，在 `index.html` 中，我们通过 `ui-view = 'body'` 定义了一个插入点，所以当 `user` 状态被激活时，`user.html` 页面会被插入到 `index.html` 中的指定位置显示。

​	插入点对应的对象即页面与控制器的绑定关系，在这个对象中，

​	`templateUrl` 定义了这个状态对应的页面；

​	`controller` 申明了这个状态对应的控制器；

​	`controllerAs` 申明了这个控制器的别名，也就是你可以用这个别名访问这个控制器的属性。如果在控制器中注入了 `$scope` 服务，这个属性可以不添加。

